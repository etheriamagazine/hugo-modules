{{ if .IsHome }}
    <script type="application/ld+json">
        {{
            partial "json-ld/website" .
            | jsonify (dict "indent" "  " )
            | safeJS
        }}
    </script>
{{ else if .IsPage }}
    <script type="application/ld+json">
        {{
            partial "json-ld/article" .
            | jsonify (dict "indent" "  " )
            | safeJS
        }}
    </script>
{{ end }}

{{ define "partials/json-ld/article.html" }}
  {{ $s := newScratch }}
  {{ $s.Set "@context" "http://schema.org" }}
  {{ $s.Set "@type" "Article" }}

  {{ with or .Title site.Title | plainify }}
    {{ $s.Set "headline" . }}
  {{ end }}

  {{ with .Params.coverImage }}
    {{ $s.Set "image" . }}
  {{ end }}

  {{ with .PublishDate }}
    {{ $s.Set "datePublished" ( . | time) }}
  {{ end }}

  {{ $s.Set "publisher" (partial "json-ld/publisher") }}

  {{ $s.Set "inLanguage" site.Language.Lang }}

  {{ with .WordCount }}
    {{ $s.Set "wordCount" . }}
  {{ end }}

  {{ with .GetTerms "authors" }}
    {{ $s.Set "authors" slice }}
    {{ range . }}
      {{ $s.Add "authors" (partial "json-ld/author" .) }}
    {{ end }}
  {{ end }}

  {{ return $s.Values }}
{{ end }}

{{ define "partials/json-ld/website.html" }}
  {{ $s := newScratch }}

  {{ $s.Set "@context" "http://schema.org" }}
  {{ $s.Set "@type" "WebSite" }}

  {{ with or site.Title site.Params.title | plainify }}
    {{ $s.Set "name" . }}
  {{ end }}

  {{ with site.BaseURL }}
    {{ $s.Set "url" . }}
  {{ end }}

  {{ with site.Params.description }}
    {{ $s.Set "description" . }}
  {{ end }}

  {{ with site.Language.Lang }}
    {{ $s.Set "inLanguage" . }}
  {{ end }}

  {{ $s.Set "publisher" (partial "json-ld/publisher") }}
  {{ return $s.Values }}
{{ end }}

{{ define "partials/json-ld/publisher.html" }}
  {{ $s := newScratch }}
  {{ $s.Set "@type" "Organization" }}
  {{ $s.Set "name" site.Params.publisher.name }}
  {{ $s.Set "url" site.BaseURL }}

  {{ $image := resources.Get "images/logo.svg" }}
  {{ $s.Set "image" $image.Permalink }}

  {{ $s.Set "sameAs" site.Params.publisher.urls }}
  {{ return $s.Values }}
{{ end }}

{{ define "partials/json-ld/author.html" }}
  {{ $s := newScratch }}
  {{ $s.Set "@type" "Person" }}
  {{ $s.Set "name" .Title }}
  {{ $s.Set "description" .Params.bio }}
  {{ $s.Set "image" (partial "gravatar/url" .Params.email) }}

  {{ with .Params.jobTitle }}
    {{ $s.Set "jobTitle" . }}
  {{ end }}
  {{ with .Params.knowsAbout }}
    {{ $s.Set "knowsAbout" . }}
  {{ end }}
  {{ with .Params.urls }}
    {{ $s.Set "sameAs" slice }}
    {{ range . }}
      {{ $s.Add "sameAs" . }}
    {{ end }}
  {{ end }}

  {{ return $s.Values }}
{{ end }}
