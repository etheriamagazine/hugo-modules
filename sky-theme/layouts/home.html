{{ define "main" }}
  {{ $latestPosts := where site.RegularPages.ByLastmod.Reverse "Type" "posts" }}

  {{/* 1. Featured Stories */}}
  {{ with site.Params.skytheme.home.featured }}
    {{ $latestPosts = where $latestPosts "Params.categories" "intersect" . }}
  {{ end }}

  {{ $featured := first 5 $latestPosts }}

  <section>
  {{ partial "hero-and-posts" (dict "posts" $featured "cols" 4) }}
  </section>

  {{/* 2. ADS display */}}
  <aside class="my-20 flex flex-col gap-10 items-center justify-center">
  {{ range partial "easyads/get.html" "home_1" }}
      {{ .Render "embed" }}
  {{ end }}
  </aside>


  {{/* 3. Subscription form to newsletter */}}
  <aside>
  {{ partial "subscribe/form.html" }}
  </aside>
  {{/* 4. Category previews */}}
  {{ $categories := slice }}

  {{ with site.Params.skytheme.home.categories }}
    {{ $categories = . }}
  {{ else }}
    {{ range $term, $v := .Site.Taxonomies.categories }}
      {{ $categories = $categories | append $term }}
    {{ end }}
  {{ end }}

  {{ range $categories }}
    {{ $wp := index site.Taxonomies.categories . }}

    {{/* Check the weighted pages for term has pages to show
      See https://gohugo.io/methods/taxonomy/get/#get-the-weighted-pages
    */}}
    {{ with and (gt $wp.Count 0) $wp }}
      <section class="mt-20">
        {{ with .Page }}
          <header class="mx-4 my-12 md:mx-36">
            <h2
              class="text-primary font-stretch-85% my-4 text-3xl uppercase md:text-4xl">
              {{ .Title }}
            </h2>
            {{ .Description }}
          </header>
        {{ end }}

        {{/* Select posts not already shown featured posts */}}
        {{ $categoryPreview := first 7 ( .Pages.ByLastmod.Reverse  | complement $featured ) }}

        {{ partial "hero-and-posts" (dict "posts" $categoryPreview "cols" 3) }}

      </section>
    {{ end }}
  {{ end }}

{{ end }}
